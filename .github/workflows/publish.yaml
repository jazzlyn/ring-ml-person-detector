---
name: publish docker image

on:
  push:
    tags:
      - "v*.*.*"
    paths-ignore:
      - .github/**

jobs:
  docker-build-push:
    uses: techtales-io/github-workflows/.github/workflows/docker-push.yaml@9dd23aa5f200750afb5ddc6171cc5987d8333f49 # v0.4.0
    permissions:
      contents: read
      id-token: write
      packages: write
    with:
      runner: ubuntu-latest
      tags: |
        type=semver,pattern={{version}}

  create-release:
    needs: docker-build-push
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # https://github.com/marketplace/actions/gh-release
      - name: create release
        uses: softprops/action-gh-release@a06a81a03ee405af7f2048a818ed3f03bbf83c7b # v2.5.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
